<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Pixel Art Generator</title>
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, sans-serif;
      background: #f7f7f7;
    }
    #app {
      text-align: center;
    }
    #controls {
      margin-bottom: 1rem;
    }
    #prompt {
      width: 260px;
      padding: 0.5rem;
      font-size: 1rem;
    }
    #generate {
      padding: 0.5rem 1rem;
      font-size: 1rem;
      margin-left: 0.5rem;
    }
    #result {
      margin-top: 1rem;
      width: 128px;
      height: 128px;
      image-rendering: pixelated;
      border: 1px solid #ccc;
      background: #fff;
    }
    #log {
      margin-top: 0.5rem;
      font-size: 0.9rem;
      color: #555;
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="controls">
      <input id="prompt" type="text" placeholder="예: 집, 나무, 하트" />
      <button id="generate">Generate</button>
    </div>
      <canvas id="result" width="32" height="32"></canvas>
    <div id="log"></div>
  </div>

  <script type="module">
    import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.2.1';

    const log = document.getElementById('log');
    const canvas = document.getElementById('result');
    const ctx = canvas.getContext('2d');
    ctx.imageSmoothingEnabled = false;

    const templates = {
      heart: {
        size: 8,
        palette: { '1': '#e74c3c' },
        data: [
          '01100110',
          '11111111',
          '11111111',
          '11111111',
          '01111110',
          '00111100',
          '00011000',
          '00000000'
        ]
      },
      tree: {
        size: 8,
        palette: { '1': '#27ae60', '2': '#8e5b3a' },
        data: [
          '00010000',
          '00111000',
          '01111100',
          '00111000',
          '00111000',
          '00020000',
          '00020000',
          '00020000'
        ]
      },
      house: {
        size: 8,
        palette: { '1': '#c0392b', '2': '#bdc3c7', '3': '#2980b9' },
        data: [
          '00010000',
          '00111000',
          '01111100',
          '11111111',
          '22222222',
          '22233222',
          '22233222',
          '22222222'
        ]
      }
    };

    function getCoords(template) {
      const { size, palette, data } = template;
      const coords = [];
      for (let y = 0; y < size; y++) {
        const row = data[y];
        for (let x = 0; x < size; x++) {
          const code = row[x];
          if (code !== '0') {
            coords.push({ x, y, color: palette[code] });
          }
        }
      }
      return coords;
    }

    function draw(coords, size) {
      const pixel = canvas.width / size;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      coords.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x * pixel, p.y * pixel, pixel, pixel);
      });
    }

    const classifier = await pipeline('zero-shot-classification', 'Xenova/nli-roberta-base-v2');

    document.getElementById('generate').addEventListener('click', async () => {
      const text = document.getElementById('prompt').value.trim();
      if (!text) return;
      const labels = Object.keys(templates);
      const result = await classifier(text, labels);
      const label = result.labels[0];
      const template = templates[label];
      const coords = getCoords(template);
      draw(coords, template.size);
      log.textContent = `${label}: ${JSON.stringify(coords)}`;
    });
  </script>
</body>
</html>
